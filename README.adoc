= Clojure Check: A command-line interface to checkers via nREPL

== Rationale

This is a quicker alternative to `lein eastwood` or `lein kibit` when you already have an nREPL running. The main driver is to be able to refer this from Vim for tools like https://github.com/w0rp/ale[ALE]

== Usage

=== Building

I use https://github.com/Masterminds/glide[glide] to build this project.

NOTE: I had to run `git config --global http.https://gopkg.in.followRedirects true` with the latest git.

[source,shell]
----
$ glide install
$ go build <1>
----
<1> Creates ./output

=== CLI usage

You can get output from eastwood & kibit on a running nREPL via

[source,shell]
----
$ ./output localhost:33999 app.website < src/app/website.clj
----

=== REPL setup

[source,clojure]
.~/.lein/profiles.clj
----
{:user
 {:dependencies
  [[jonase/eastwood "0.2.3" :exclusions [org.clojure/clojure]]
   [jonase/kibit "0.1.3" :exclusions [org.clojure/clojure]]]}}
----

[source,clojure]
.~/.boot/profile.boot
----
;; OR merge this with your cider task
(deftask linters "Linter profile"
  []
  (require 'boot.repl)
  (swap! @(resolve 'boot.repl/*default-dependencies*)
         concat '[[jonase/eastwood "0.2.3" :exclusions [org.clojure/clojure]]
                  [jonase/kibit "0.1.3" :exclusions [org.clojure/clojure]])
  identity)
----

=== ALE

I'm currently using this configuration with ALE, I don't expect the CLI API to remain particularly stable, so I've not committed this yet.

[source,viml]
----
" Packages
Plug 'tpope/vim-fireplace'
Plug 'w0rp/ale'

" ALE config
let g:clojure_check_bin = '/absolute/path/to/clojure-check/output'
function! s:ClojureHost()
  return fireplace#client().connection.transport.host
endfunction

function! s:ClojurePort()
  return fireplace#client().connection.transport.port
endfunction

function! ClojureCheck(buffer)
  try
    return g:clojure_check_bin.' '.s:ClojureHost().':'.s:ClojurePort().' '.fireplace#ns(a:buffer)
  catch /Fireplace/
    return ''
  endtry
endfunction

call ale#linter#Define('clojure', {
\   'name': 'clojure_check',
\   'executable': g:clojure_check_bin,
\   'command_callback': 'ClojureCheck',
\   'callback': 'ale#handlers#HandleUnixFormatAsError',
\})

----
